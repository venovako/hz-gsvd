INTEGER FUNCTION GET_NTHR()

  USE OMP_LIB

  IF (OMP_IN_PARALLEL()) THEN
     GET_NTHR = OMP_GET_NUM_PROCS()
  ELSE
     GET_NTHR = OMP_GET_MAX_THREADS()
  END IF

END FUNCTION GET_NTHR
