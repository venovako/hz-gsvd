INTEGER FUNCTION BLAS_SET_NUM_THREADS(NT)

#ifdef USE_LAPACK_PAR
  USE, INTRINSIC :: ISO_C_BINDING
#ifdef USE_MKL
#ifdef USE_INTEL
  USE MKL_SERVICE
#endif
  IMPLICIT NONE
  INTEGER, INTENT(IN) :: NT
#ifdef USE_GNU
  INTEGER(c_int), EXTERNAL :: MKL_SET_NUM_THREADS_LOCAL
#endif

  BLAS_SET_NUM_THREADS = INT(MKL_SET_NUM_THREADS_LOCAL(INT(NT,c_int)))
#else
  USE OMP_LIB
  IMPLICIT NONE
  INTEGER, INTENT(IN) :: NT

  BLAS_SET_NUM_THREADS = INT(OMP_GET_NUM_THREADS())
  CALL OMP_SET_NUM_THREADS(INT(NT,c_int))
#endif
#else
  IMPLICIT NONE
  INTEGER, INTENT(IN) :: NT

  IF ((NT .LT. 0) .OR. (NT .GT. 1)) THEN
     BLAS_SET_NUM_THREADS = -1
  ELSE
     BLAS_SET_NUM_THREADS = 0
  END IF
#endif
END FUNCTION BLAS_SET_NUM_THREADS
